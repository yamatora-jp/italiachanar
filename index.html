<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Babylon.js + AR.js Marker AR</title>

  <!-- Babylon.js -->
  <script src="https://cdn.babylonjs.com/babylon.js"></script>

  <!-- AR.js Babylon.js binding -->
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/examples/babylon/aframe-babylon.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">
  <canvas id="renderCanvas"></canvas>

  <script>
    const canvas = document.getElementById("renderCanvas");
    const engine = new BABYLON.Engine(canvas, true);
    const scene = new BABYLON.Scene(engine);

    // カメラは AR.js が制御
    const camera = new BABYLON.Camera("camera", scene);

    // ライト
    new BABYLON.HemisphericLight("light", new BABYLON.Vector3(0, 1, 0), scene);

    // マーカー root
    const markerRoot = new BABYLON.TransformNode("markerRoot", scene);

    // ここにPLYモデルをロードして markerRoot に追加
    loadColoredPLY("./gs_italiachan.splat").then(mesh => {
      mesh.parent = markerRoot;
    });

    // AR.js Babylon 初期化
    const arToolkit = new ARjsBabylon(engine, scene, camera, {
      sourceType: 'webcam',
      detectionMode: 'mono',
      matrixCodeType: '3x3',
    });

    // Hiroマーカー検出
    const marker = arToolkit.addMarker(markerRoot, {
      type: 'pattern',
      patternUrl: 'https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/examples/marker-training/examples/pattern-files/pattern-hiro.patt',
    });

    // Render loop
    engine.runRenderLoop(() => {
      scene.render();
    });
  </script>
</body>
</html>
